{"componentChunkName":"component---src-pages-index-js","path":"/","result":{"data":{"hero":{"edges":[{"node":{"frontmatter":{"title":"Hi, my name is","name":"Varun","subtitle":"I build things for the web.","contactText":"Get In Touch"},"html":"<p>I'm a self taught developer based in New Delhi, India specializing in building exceptional, high-quality websites and applications.</p>"}}]},"about":{"edges":[{"node":{"frontmatter":{"title":"About Me","avatar":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='400'%20viewBox='0%200%20400%20400'%20preserveAspectRatio='none'%3e%3cpath%20d='M168%202a116%20116%200%2000-25%205c-5%201-8%202-10%204l-6%205-3%204c1%201%201%202-2%204-7%207-7%2018-1%2040a188%20188%200%200010%2029l4%2012c2%205%202%208%200%2014l-3%205c-1-1-10%208-8%209l2%201c2-1%204%201%203%203l-1%201-1-1c1-1%200-1%200%200l-3-1c0-2-3-1-3%200l-1%204c-1%200-2-1-1-2%200-2%200-2-3%200-1%202-3%204-2%205l-1%201h-1l2%201c2%201%202%201%201%202v1l-1%201c-1-1-1-1%200%200h-2c1%201-6%208-7%208l-1%204-1%201c-1-1-2%200-3%201%200%202%200%202-4%202l-4%202-5%203-2%201-3%202-5%203-3%201v2h-1c-1-1-1-1-2%201l-1%202c-1%200-4%207-4%2012l-1%205%201-4c2-2%203-3%205-2l3-1c-1-1%200-2%201-2l1-1h-1l-1-1v-4c2-3%2016-14%2016-13l-1%202-1%202-2%201-1%202-2%202-1%202v1c-2%200-3%205-1%207l2%203%201%202%201-2%202-2%201-3h-1c-2%200-1-2%201-3%201-2%202-2%202-1h2v-5c1-3%201-3%203-2h2l1%201-1%201v7l-1%201v1l-1%202-1%201v2c2%200%202%201%201%201v2c1%201%201%201-1%201-2-1-2-1-1%202v5l-1%201v2c0%201%200%202-2%202v5l-1%202-1%202-2%202%202%202v11c1%200%201%201-1%201-2%201-2%201%201%201l4%201H61v11l-2%2031c-1%2029-2%2030-5%2029-2%200-3%200-3%202v46c-1%201-1%207%201%2010%202%204%201%208-1%208v3l2%201c1-1%202%200%204%201l4%205c4%203%206%207%205%208h-4c-1%202-9%201-9-1l-1-1-1%202h1l1%201%201%202c2%201%203%203%200%203-1-1-1-1-1%201l1%202%205-1a8369%208369%200%2000239%201c3-2%203-2%203-5%200-2%200-3%202-3%202-1%205%202%205%205-1%202%203%202%2011%202%203-1%204-1%204-4%201-4%205-4%207-1%201%203%205%204%207%202s2-2%200-3c-4-2-1-4%209-4l3-1c0-3-8-8-8-6%200%201-2%202-6%202h-6v-4c0-3%202-5%204-3s3%200%201-2v-3l-2-1c-1-1-2%200-2%201l-5%201c-3-1-5-1-6%201-2%203-2-2%200-6l3-6c0-3%202-2%204%200%203%203%203%203%205%200v-3c-2-1-3-7-1-9%201-2%201-2-1-4h-3c0%204-13%207-16%204-2-1%200-3%202-3%205%200%207-3%207-8-1-4-1-4%203-5%205-1%206-1%206%201%200%204%201%205%204%204%201-1%202-2%201-3-2-6-2-7%201-9%202-2%202-2%200-2l-3-1c-1-1-5%201-5%202%200%202-2%201-3-2-2-4-4-2-5%204%200%207-1%208-3%203%200-2-2-4-3-5l-4-3-5-2-3-4c0-3%200-3-1-2l-3%202c-1%200-4%205-3%206h2c3-2%206%200%206%203l1%206-1%204c-2%201-2%200-2-1%200-2-1-2-6-2l-6%201-2%202c-2%201-3%202-3%204%200%204%200%205-4%204-2%200-2-1-1-2%202-2-1-5-4-3l-10%2010-1%202-3-3c-3-3-5-3-5%200%200%201-1%203-3%203l-2%203c1%201-2%204-3%204-2%200-1-4%200-5%202%200%202-1%200-4l-1-6c1-3-3-3-3%200l-2%202c-2%200-2-2-1-3v-2c-1-1-1-7%201-9v-2c-2-1-4%201-4%204-1%202-1%203-5%203l-4%201-3%202c-1%200-2-3-1-4v-8c0-3%200-4-2-6s-2-2%200-3v-4a270%20270%200%20015-91c0-4-5-21-9-28l-14-31c-4-3-11-8-12-7l-1-1-1-2-3-4c-2-3-2-4-1-10%203-13%208-19%2016-21l7-1%206-2c4-1%208-5%208-7l-2-5-2-8-1-3-1-7%201-6c2-2%201-6-1-9-3-3-3-3-2-6%202-5%202-9-1-13l-6-10-4-6%202-4c4-6%202-19-4-22l-20-8h-13m123%20335l-1%205-2%207c-6%2012-5%2016%203%2014%205-1%206-2%206-5l1-9c2-5%202-5%200-9-3-4-5-5-7-3m-24%2026l-7%203c-2%201-3%201-4-1-1-1-1-1-3%201l-4%203c-2%201-3%203-1%203l2%203c1%202%203%202%204%200%200-3%200-3%202-2h2c2-3%203-2%203%200-1%203-1%203%203%203%204%201%206%204%203%207-2%203-1%204%203%201%203-2%203-2%205-1%205%203%207%201%203-2-2-2-2-2-1-3s2-2%202-5c0-4%201-5%202-2%201%202%203%203%205%201l-2-1c-2%200-3-1%200-3%202-3%201-4-9-5h-8m48%200l-6%201c-3%200-5%200-5%202h-5l-5%202c-3%200-5%202-5%203%200%202%203%202%205%200l4-1c3%202%202%203-3%204s-7%204-3%204c3%200%206%203%205%205%200%202%200%202%202%201%202-3%203-2%203%201%200%202%200%202%204%202l5-2v-5c-1%200%200-4%202-6v-3c-1-4-1-5%202-4%203%200%206-2%205-4h-5'%20fill='%2364ffda'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1,"src":"/static/92b6f14c78faeca823577de6069e4edd/ea4ab/me.jpg","srcSet":"/static/92b6f14c78faeca823577de6069e4edd/477ba/me.jpg 175w,\n/static/92b6f14c78faeca823577de6069e4edd/06776/me.jpg 350w,\n/static/92b6f14c78faeca823577de6069e4edd/ea4ab/me.jpg 700w,\n/static/92b6f14c78faeca823577de6069e4edd/3055e/me.jpg 1050w,\n/static/92b6f14c78faeca823577de6069e4edd/eff08/me.jpg 1400w,\n/static/92b6f14c78faeca823577de6069e4edd/f92a2/me.jpg 2896w","srcWebp":"/static/92b6f14c78faeca823577de6069e4edd/89afa/me.webp","srcSetWebp":"/static/92b6f14c78faeca823577de6069e4edd/9fca7/me.webp 175w,\n/static/92b6f14c78faeca823577de6069e4edd/37a4e/me.webp 350w,\n/static/92b6f14c78faeca823577de6069e4edd/89afa/me.webp 700w,\n/static/92b6f14c78faeca823577de6069e4edd/78e7a/me.webp 1050w,\n/static/92b6f14c78faeca823577de6069e4edd/03d34/me.webp 1400w,\n/static/92b6f14c78faeca823577de6069e4edd/6d214/me.webp 2896w","sizes":"(max-width: 700px) 100vw, 700px"}}},"skills":["JavaScript (ES6+)","HTML & (S)CSS","React","Node.js","Express","GraphQL","Progressive Web Apps","Git & Github"]},"html":"<p>Hello! I'm Varun, a web developer based in New Delhi, India who enjoys building things that live on the internet. I develop exceptional websites and web apps leveraging some cutting edge web technologies with efficient and modern backends.</p>\n<p>I am both driven and self-motivated. I love to explore new technologies &#x26; techniques, and strive to better myself as a developer, and the development community as a whole.</p>\n<p>Here's a few technologies I've been working with recently:</p>"}}]},"featured":{"edges":[{"node":{"frontmatter":{"title":"Vuzuk","cover":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='199'%20viewBox='0%200%20400%20199'%20preserveAspectRatio='none'%3e%3cpath%20d='M0%20100l1%2066%201-33%20199-1h199v33l1-66V0H0v100m0%200c0%2055%201%2072%201%2038V76h93v17l1%2017h7V76h3c5%200%205%200%204-4v-4H1V34l-1%2066m262-88v5h61V7h-61v5m109%200v5h24V7h-24v5M157%2068c-5%201-11%207-12%2012-3%208-1%2022%205%2026%203%203%2011%205%2016%204%206-2%207-2%206-7v-4l-3%202c-4%202-11%202-14-1-5-6-4-19%202-23%203-2%2010-2%2012%200%204%203%204%203%204-2%200-4%200-5-2-6-3-2-10-2-14-1m-40%2021v21h19v-8h-11V92h11v-7h-11v-9h11v-8h-19v21m63%200l1%2021h7V92h13v18h199v-8H209V69h-7l-1%208v8h-13V68h-8v21m-14%2079v6l1%205h25v-11l-13-1-13%201m204%200v6l1%205h25v-11l-13-1-13%201m-156%201c-5%203-6%207-3%2011%204%205%2013%202%2013-4%200-4-7-9-10-7M8%20172l-2%204c0%202%204%206%206%206s6-5%206-6c0-3-4-6-6-6l-4%202m158%2023v4h26v-9h-26v5m204%200v4h26v-9h-26v5'%20fill='%2364ffda'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":2.0114942528735633,"src":"/static/da35d9af2571d2a1c6262a5511cae04e/60290/vuzuk.png","srcSet":"/static/da35d9af2571d2a1c6262a5511cae04e/847ef/vuzuk.png 175w,\n/static/da35d9af2571d2a1c6262a5511cae04e/91cba/vuzuk.png 350w,\n/static/da35d9af2571d2a1c6262a5511cae04e/60290/vuzuk.png 700w,\n/static/da35d9af2571d2a1c6262a5511cae04e/7aca3/vuzuk.png 963w","srcWebp":"/static/da35d9af2571d2a1c6262a5511cae04e/89afa/vuzuk.webp","srcSetWebp":"/static/da35d9af2571d2a1c6262a5511cae04e/9fca7/vuzuk.webp 175w,\n/static/da35d9af2571d2a1c6262a5511cae04e/37a4e/vuzuk.webp 350w,\n/static/da35d9af2571d2a1c6262a5511cae04e/89afa/vuzuk.webp 700w,\n/static/da35d9af2571d2a1c6262a5511cae04e/817d9/vuzuk.webp 963w","sizes":"(max-width: 700px) 100vw, 700px"}}},"tech":["React","Express","NodeJS","Webpack","SSR"],"github":"https://github.com/vuzuk/webapp","external":"https://vuzuk.com/","show":"true"},"html":"<p>Vuzuk brings all the blogs and bloggers under one roof through which it becomes a lifestyle guidebook where reading enthusiasts can unveil the blogs, articles and reviews by a variety of bloggers around the world. Mainly in Food, Fashion, Tech &#x26; Travel.</p>"}},{"node":{"frontmatter":{"title":"KWIZ - Online Quiz Portal","cover":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='202'%20viewBox='0%200%20400%20202'%20preserveAspectRatio='none'%3e%3cpath%20d='M0%2010v10h199l200-1c2%200%202-2%202-10V0H0v10m9%20114v13l1%2011h78a18035%2018035%200%2000255-1h-48v-23h-72a18381%2018381%200%2001-214%200m290%2017c0%202%202%204%204%204l7-1%206-1h1l2%201h9c2%200%203%200%203-2l-7-1h-7l-13-1-5%201m-24%2028c-15%204-24%2014-28%2030v3h34v-34l-6%201m8%2016v17h34v-4c-3-14-15-27-29-29l-5-1v17m98-7c-7%204-6%2015%201%2016%207%202%2012-2%2012-8s-8-10-13-8'%20fill='%2364ffda'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1.9886363636363635,"src":"/static/1959d6fcf107988d03334f92c82e0a7f/60290/kwiz.png","srcSet":"/static/1959d6fcf107988d03334f92c82e0a7f/847ef/kwiz.png 175w,\n/static/1959d6fcf107988d03334f92c82e0a7f/91cba/kwiz.png 350w,\n/static/1959d6fcf107988d03334f92c82e0a7f/60290/kwiz.png 700w,\n/static/1959d6fcf107988d03334f92c82e0a7f/f5f50/kwiz.png 1050w,\n/static/1959d6fcf107988d03334f92c82e0a7f/d38a4/kwiz.png 1284w","srcWebp":"/static/1959d6fcf107988d03334f92c82e0a7f/89afa/kwiz.webp","srcSetWebp":"/static/1959d6fcf107988d03334f92c82e0a7f/9fca7/kwiz.webp 175w,\n/static/1959d6fcf107988d03334f92c82e0a7f/37a4e/kwiz.webp 350w,\n/static/1959d6fcf107988d03334f92c82e0a7f/89afa/kwiz.webp 700w,\n/static/1959d6fcf107988d03334f92c82e0a7f/78e7a/kwiz.webp 1050w,\n/static/1959d6fcf107988d03334f92c82e0a7f/92764/kwiz.webp 1284w","sizes":"(max-width: 700px) 100vw, 700px"}}},"tech":["React","Node.js","Express","SPA"],"github":"https://github.com/varunzxzx/kwiz","external":"https://kwiz-msi.herokuapp.com/","show":"true"},"html":"<p>KWIZ is an online quiz portal dedicated for C++. It provides students to test their\nprogramming ability apart from the curriculum. It also has a resources section,\nwhere students get the required resources for the quiz. It engages the students by\nproviding valuable insights and a leaderboard.</p>"}}]},"projects":{"edges":[{"node":{"frontmatter":{"title":"babel-plugin-use-css","image":"","tech":["babel-plugin","CSS","React"],"github":"https://github.com/varunzxzx/babel-plugin-use-css","external":"","show":"true"},"html":"<p>Allow extracting static CSS from <a href=\"https://github.com/siddharthkp/use-css#readme\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">use-css</a></p>"}},{"node":{"frontmatter":{"title":"Sync Band","image":"","tech":["PWA","React","SocketIO"],"github":"https://github.com/varunzxzx/sync-band","external":"","show":"true"},"html":"<p>A progressive web application that sync the song lyrics and chords through out the band</p>"}},{"node":{"frontmatter":{"title":"Quick Spot","image":"","tech":["Node.js","Google Maps"],"github":"https://github.com/varunzxzx/quick-spot","external":"","show":"true"},"html":"<p>A NodeJS applications which finds nearest hospital with feasible travel time using Google Maps API.\nMore on: <a href=\"https://varunzxzx.github.io/quick-spot/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://varunzxzx.github.io/quick-spot/</a></p>"}}]},"blogPosts":{"edges":[{"node":{"frontmatter":{"title":"NodeJS: Not So Single Threaded","date":"2022-11-11","slug":"/blog/nodejs-not-so-single-threaded","tags":["nodejs","multi-tasking","performance"],"show":"true","authorName":"Varun","authorImg":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='400'%20viewBox='0%200%20400%20400'%20preserveAspectRatio='none'%3e%3cpath%20d='M168%202a116%20116%200%2000-25%205c-5%201-8%202-10%204l-6%205-3%204c1%201%201%202-2%204-7%207-7%2018-1%2040a188%20188%200%200010%2029l4%2012c2%205%202%208%200%2014l-3%205c-1-1-10%208-8%209l2%201c2-1%204%201%203%203l-1%201-1-1c1-1%200-1%200%200l-3-1c0-2-3-1-3%200l-1%204c-1%200-2-1-1-2%200-2%200-2-3%200-1%202-3%204-2%205l-1%201h-1l2%201c2%201%202%201%201%202v1l-1%201c-1-1-1-1%200%200h-2c1%201-6%208-7%208l-1%204-1%201c-1-1-2%200-3%201%200%202%200%202-4%202l-4%202-5%203-2%201-3%202-5%203-3%201v2h-1c-1-1-1-1-2%201l-1%202c-1%200-4%207-4%2012l-1%205%201-4c2-2%203-3%205-2l3-1c-1-1%200-2%201-2l1-1h-1l-1-1v-4c2-3%2016-14%2016-13l-1%202-1%202-2%201-1%202-2%202-1%202v1c-2%200-3%205-1%207l2%203%201%202%201-2%202-2%201-3h-1c-2%200-1-2%201-3%201-2%202-2%202-1h2v-5c1-3%201-3%203-2h2l1%201-1%201v7l-1%201v1l-1%202-1%201v2c2%200%202%201%201%201v2c1%201%201%201-1%201-2-1-2-1-1%202v5l-1%201v2c0%201%200%202-2%202v5l-1%202-1%202-2%202%202%202v11c1%200%201%201-1%201-2%201-2%201%201%201l4%201H61v11l-2%2031c-1%2029-2%2030-5%2029-2%200-3%200-3%202v46c-1%201-1%207%201%2010%202%204%201%208-1%208v3l2%201c1-1%202%200%204%201l4%205c4%203%206%207%205%208h-4c-1%202-9%201-9-1l-1-1-1%202h1l1%201%201%202c2%201%203%203%200%203-1-1-1-1-1%201l1%202%205-1a8369%208369%200%2000239%201c3-2%203-2%203-5%200-2%200-3%202-3%202-1%205%202%205%205-1%202%203%202%2011%202%203-1%204-1%204-4%201-4%205-4%207-1%201%203%205%204%207%202s2-2%200-3c-4-2-1-4%209-4l3-1c0-3-8-8-8-6%200%201-2%202-6%202h-6v-4c0-3%202-5%204-3s3%200%201-2v-3l-2-1c-1-1-2%200-2%201l-5%201c-3-1-5-1-6%201-2%203-2-2%200-6l3-6c0-3%202-2%204%200%203%203%203%203%205%200v-3c-2-1-3-7-1-9%201-2%201-2-1-4h-3c0%204-13%207-16%204-2-1%200-3%202-3%205%200%207-3%207-8-1-4-1-4%203-5%205-1%206-1%206%201%200%204%201%205%204%204%201-1%202-2%201-3-2-6-2-7%201-9%202-2%202-2%200-2l-3-1c-1-1-5%201-5%202%200%202-2%201-3-2-2-4-4-2-5%204%200%207-1%208-3%203%200-2-2-4-3-5l-4-3-5-2-3-4c0-3%200-3-1-2l-3%202c-1%200-4%205-3%206h2c3-2%206%200%206%203l1%206-1%204c-2%201-2%200-2-1%200-2-1-2-6-2l-6%201-2%202c-2%201-3%202-3%204%200%204%200%205-4%204-2%200-2-1-1-2%202-2-1-5-4-3l-10%2010-1%202-3-3c-3-3-5-3-5%200%200%201-1%203-3%203l-2%203c1%201-2%204-3%204-2%200-1-4%200-5%202%200%202-1%200-4l-1-6c1-3-3-3-3%200l-2%202c-2%200-2-2-1-3v-2c-1-1-1-7%201-9v-2c-2-1-4%201-4%204-1%202-1%203-5%203l-4%201-3%202c-1%200-2-3-1-4v-8c0-3%200-4-2-6s-2-2%200-3v-4a270%20270%200%20015-91c0-4-5-21-9-28l-14-31c-4-3-11-8-12-7l-1-1-1-2-3-4c-2-3-2-4-1-10%203-13%208-19%2016-21l7-1%206-2c4-1%208-5%208-7l-2-5-2-8-1-3-1-7%201-6c2-2%201-6-1-9-3-3-3-3-2-6%202-5%202-9-1-13l-6-10-4-6%202-4c4-6%202-19-4-22l-20-8h-13m123%20335l-1%205-2%207c-6%2012-5%2016%203%2014%205-1%206-2%206-5l1-9c2-5%202-5%200-9-3-4-5-5-7-3m-24%2026l-7%203c-2%201-3%201-4-1-1-1-1-1-3%201l-4%203c-2%201-3%203-1%203l2%203c1%202%203%202%204%200%200-3%200-3%202-2h2c2-3%203-2%203%200-1%203-1%203%203%203%204%201%206%204%203%207-2%203-1%204%203%201%203-2%203-2%205-1%205%203%207%201%203-2-2-2-2-2-1-3s2-2%202-5c0-4%201-5%202-2%201%202%203%203%205%201l-2-1c-2%200-3-1%200-3%202-3%201-4-9-5h-8m48%200l-6%201c-3%200-5%200-5%202h-5l-5%202c-3%200-5%202-5%203%200%202%203%202%205%200l4-1c3%202%202%203-3%204s-7%204-3%204c3%200%206%203%205%205%200%202%200%202%202%201%202-3%203-2%203%201%200%202%200%202%204%202l5-2v-5c-1%200%200-4%202-6v-3c-1-4-1-5%202-4%203%200%206-2%205-4h-5'%20fill='%2364ffda'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1,"src":"/static/92b6f14c78faeca823577de6069e4edd/ac0f8/me.jpg","srcSet":"/static/92b6f14c78faeca823577de6069e4edd/c49f2/me.jpg 8w,\n/static/92b6f14c78faeca823577de6069e4edd/eb08a/me.jpg 15w,\n/static/92b6f14c78faeca823577de6069e4edd/ac0f8/me.jpg 30w,\n/static/92b6f14c78faeca823577de6069e4edd/3065f/me.jpg 45w,\n/static/92b6f14c78faeca823577de6069e4edd/b49c9/me.jpg 60w,\n/static/92b6f14c78faeca823577de6069e4edd/f92a2/me.jpg 2896w","srcWebp":"/static/92b6f14c78faeca823577de6069e4edd/c6ef4/me.webp","srcSetWebp":"/static/92b6f14c78faeca823577de6069e4edd/48c71/me.webp 8w,\n/static/92b6f14c78faeca823577de6069e4edd/d12fe/me.webp 15w,\n/static/92b6f14c78faeca823577de6069e4edd/c6ef4/me.webp 30w,\n/static/92b6f14c78faeca823577de6069e4edd/915d4/me.webp 45w,\n/static/92b6f14c78faeca823577de6069e4edd/c26a1/me.webp 60w,\n/static/92b6f14c78faeca823577de6069e4edd/6d214/me.webp 2896w","sizes":"(max-width: 30px) 100vw, 30px"}}},"featuredImg":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='250'%20viewBox='0%200%20400%20250'%20preserveAspectRatio='none'%3e%3cpath%20d='M0%20125v125h401V0H0v125m150-8l-8%205-7%204v21l9%205%209%205%208-5%209-5v-21l-7-4c-10-6-10-6-13-5m136%204l-8%205-1%209c0%2011%200%2012%205%2015%207%202%207%201%208-11l-1-10-1%209c0%2010-1%2011-5%209l-3-1v-10l1-9%207-4%208-4%207%204%208%205v18l-8%204c-4%202-8%204-9%203-6-2-7%200-2%203%204%201%204%201%2012-4l9-5v-21l-8-5c-10-6-10-6-19%200m9%208c-5%202-3%208%203%209%205%200%206%201%206%202-1%202-8%202-9%201%200-2-3-2-3-1l2%203c5%204%2013%201%2013-3%200-3-1-4-6-5-3%200-5-1-5-2%200-3%205-3%207%200%202%202%205%201%203-2s-7-4-11-2'%20fill='%2364ffda'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1.5957446808510638,"src":"/static/a53563568603d377979df66139cdae34/b3cab/nodejs-wall.jpg","srcSet":"/static/a53563568603d377979df66139cdae34/af138/nodejs-wall.jpg 75w,\n/static/a53563568603d377979df66139cdae34/62067/nodejs-wall.jpg 150w,\n/static/a53563568603d377979df66139cdae34/b3cab/nodejs-wall.jpg 300w,\n/static/a53563568603d377979df66139cdae34/4507f/nodejs-wall.jpg 450w,\n/static/a53563568603d377979df66139cdae34/39f27/nodejs-wall.jpg 600w,\n/static/a53563568603d377979df66139cdae34/e0b36/nodejs-wall.jpg 1131w","srcWebp":"/static/a53563568603d377979df66139cdae34/5ba9d/nodejs-wall.webp","srcSetWebp":"/static/a53563568603d377979df66139cdae34/e0887/nodejs-wall.webp 75w,\n/static/a53563568603d377979df66139cdae34/4a599/nodejs-wall.webp 150w,\n/static/a53563568603d377979df66139cdae34/5ba9d/nodejs-wall.webp 300w,\n/static/a53563568603d377979df66139cdae34/ed1b3/nodejs-wall.webp 450w,\n/static/a53563568603d377979df66139cdae34/6ef99/nodejs-wall.webp 600w,\n/static/a53563568603d377979df66139cdae34/8beef/nodejs-wall.webp 1131w","sizes":"(max-width: 300px) 100vw, 300px"}}}},"timeToRead":8,"excerpt":"NodeJS: Not so single threaded In today's world more than 30 million websites uses NodeJS. NodeJS is being used by at least 30 million websites. With NodeJS, PayPal and Netflix cut their startup times from more than 40+ minutes to under a minute. Companies have seen a 12% reduction in development…","html":"<h2>NodeJS: Not so single threaded</h2>\n<p>In today's world more than 30 million websites uses NodeJS. NodeJS is being used by at least 30 million websites. With NodeJS, PayPal and Netflix cut their startup times from more than 40+ minutes to under a minute. Companies have seen a 12% reduction in development costs after using NodeJS. NodeJS is the first choice when it comes to building scalable web applications.</p>\n<p>So, how NodeJS being single threaded able to achieve all of this. Let's deep dive into the internals of NodeJS to see how it works.</p>\n<p>So when we say NodeJS is single threaded, it means that all the Javascript like every single javascript file you wrote and are there in your modules, also the javascript that is in Node itself and Node does have JavaScript as part of it, all of them runs in a one single thread which we typically call the main thread. So this is what we mean when we say Javascript is single threaded because all these things are running in a single thread however there is little more to NodeJS, there's actually a fair amount of C++ code in NodeJS too. I forgot the ratio but I thinks It is 2/3rd JavaScript to 1/3rd C++ and that's a pretty good chunk and C++ is different because C++ has access to threads but it depends on how it's being run.</p>\n<p>If you have a JavaScript method that you're calling from Node and it's backed by a C++ method and if it's a synchronous javascript call then that C++ code will always run on the main thread.</p>\n<p>However if you're calling an asynchronous method from JavaScript and this method is backed by some C++, sometimes it runs on the main thread and sometimes it doesn't, it actually depends on the context in which you're making this function call.</p>\n<p>To understand this a bit better, we're going to look at some examples.</p>\n<h3>Example #1</h3>\n<p>We'll first look at the <code class=\"language-text\">crypto</code> module because it has lot of methods in it some asynchronous and some asynchronous, and they are very CPU intensive they do a lot of math and it takes a lot of time so we'll start by looking at the pbkdf2 method, this is a method for hashing so we take some random string we feed it into this and it'll give us a hash out. What we're gonna do is we're gonna start by calling the synchronous version of this method I'm going to call it four times</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">NUM_REQUESTS</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">NUM_REQUESTS</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    crypto<span class=\"token punctuation\">.</span><span class=\"token function\">pbkdf2Sync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secret\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"salt\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sha512'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>so it's gonna call it once and then the time after that, so when we run this code we get an execution timeline that looks like this</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1100px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2e66834b9b586481be07752815cad4a7/05775/crypto-sync-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.81818181818182%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABsklEQVQoz22S108CQRDGUWyU4xBFEMUSLCDg3WEEQQKIBqPYwEixYCzR6IMtlhf92z935jwQ5WEyt7cz3/722zFZPVGY5Rl0SQGObkcANk8EkncR1pEIhqeWMRXOYnIhA/d0nP/ZxV6nsIowST4VhfI99uov2Kk+oVh5hCeQhDymcTjHNUijCizuMBw+hRvlMVV8q5yNNYVN1JnsYiO9eY787g1yxWtki1eCMIoe5yyT9w7OYWA4xKIkrgtofwT1w+0kaBtdRP9QEH2ueRag5kLpDqXTN+zWnlE6e8f6/i0LDPpjeh6PdRBUDUGFC/RiBa6JJSTyx8hsXSBVaCC7fYlY5oiJ6WAjEzFT/SdUfjzQmn4YxD3OORZwTydwcPKGsqAl8v2TV3hnUpB9apPYKfrpth0F6bt1LY2b44I6uXHK9BRE2O/SDyab7N7ob0Kt7cX++kNWGI9jlmfF6ISxXXlA9fITh40P1K6/EEnsoU/s86PIvnZCR9taa44L+Uxk5LOyWkZ8rS78rTDx5EIOFjG/JpsolIQoiVATZWr6vfYEVuAPplmw5XOIiZtXFqNGM/0N8bsfZRkGvdwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"crypto-sync-4\"\n        title=\"crypto-sync-4\"\n        src=\"/static/2e66834b9b586481be07752815cad4a7/140de/crypto-sync-4.png\"\n        srcset=\"/static/2e66834b9b586481be07752815cad4a7/7bc88/crypto-sync-4.png 275w,\n/static/2e66834b9b586481be07752815cad4a7/c1dff/crypto-sync-4.png 550w,\n/static/2e66834b9b586481be07752815cad4a7/140de/crypto-sync-4.png 1100w,\n/static/2e66834b9b586481be07752815cad4a7/09a33/crypto-sync-4.png 1650w,\n/static/2e66834b9b586481be07752815cad4a7/05775/crypto-sync-4.png 1768w\"\n        sizes=\"(max-width: 1100px) 100vw, 1100px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>and this is what we would expect for synchronous code. we call it once it's gonna start it's gonna run to completion and then once it's done we're gonna call  the next one and it's gonna run until completion and we see that this took about 190 milliseconds.</p>\n<p>Now we're gonna make one single change</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">NUM_REQUESTS</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">NUM_REQUESTS</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    crypto<span class=\"token punctuation\">.</span><span class=\"token function\">pbkdf2</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"secret\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"salt\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sha512'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>so this the exact same code that we saw earlier except, instead of calling the synchronous version pbkdf2 we are calling the asynchronous version, everything else is exactly the same except we swapped those out and so when we run this code we get an execution time line that looks like</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1100px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fd5e083b07997603de655df205648b57/a969d/crypto-async-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.545454545454554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABkUlEQVQoz51SSy+DQRQtC7T1VbVVfXmVlr4+VZSGaCxIhTaKKBFBgwWtfiwkgth4hDXi3x733q8VEknTLk5OZubcM+fOXIPRGUWL4kerZViY0W4PQXGPw0Rn7pEUhtVFQa9/RvY6Xeq/MBMMrsAcMpslrGyVsZw/w1pBQziZhbk3CosnLkKTM0brmFzCsHonZN/q07mL1l2spTODOziP7M4lcrtXWN2uYGP/WgxNzoiIfsBFBDH0/TW0ylkciocM7QPT1M4SghMZ+IkDxMHECokTUswpLR6dpaieoS+URrH8giPC4fkTjiuvKBRvYeufpGK1cUNrX4KKp+D0z+o8NAPHYFI3aiZhf2QR2t0ntNsPXNy84+r+CyfaG+xk3nRCfi9OVWNO+tuosTccS+Oo9IxDwsHZo7zn3ukDzVyKxLGqYe2n4/XHhhNFkjmoqXUZFzWVF7b1TUoxC7l1Rm1suqkrNmLmfTbmSxTSGni622yjMPaEdXaE0eEIVUdGH2RvcA4D4QXdoNpiLaFc6tU7YMNvqM5AupFLlAoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"crypto-async-4\"\n        title=\"crypto-async-4\"\n        src=\"/static/fd5e083b07997603de655df205648b57/140de/crypto-async-4.png\"\n        srcset=\"/static/fd5e083b07997603de655df205648b57/7bc88/crypto-async-4.png 275w,\n/static/fd5e083b07997603de655df205648b57/c1dff/crypto-async-4.png 550w,\n/static/fd5e083b07997603de655df205648b57/140de/crypto-async-4.png 1100w,\n/static/fd5e083b07997603de655df205648b57/09a33/crypto-async-4.png 1650w,\n/static/fd5e083b07997603de655df205648b57/a969d/crypto-async-4.png 1720w\"\n        sizes=\"(max-width: 1100px) 100vw, 1100px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p> we can see that we did those four same calls and they took about the same time for each one but it was actually\nable to run them in parallel and so we can see the whole thing took less than 60 milliseconds, that is quite a bit faster than the synchronous version and so what this tells us is that we didn't write any threading code inside of JavaScript we just wrote normal regular JavaScript and yet it was actually able to run these to operations in parallel and it turns out under the hood it actually ran these in separate threads because there's some C++ methods that Node uses to actually compute this and BTW there's a recommendation with Node that you always use the asynchronous methods whenever possible this is exactly why  because by using the asynchronous methods in a lot of cases Node is able to automatically run things in parallel for you but if you use the synchronous methods, you never give Node the chance to do that so you always want to use asynchronous because you can get some pretty big performance benefits a lot of the time.</p>\n<p>We saw for both synchronous and asynchronous now let's say we increase this from four requests to six requests</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1100px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5197376a105da5d5787a9b2512683a03/a969d/crypto-async-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.545454545454554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABi0lEQVQoz5WT2U/CQBDGm2g0XBaPcnuCaDgLBrkLNcgtGohEExUVMSRq/P+fxplp1wg+KA9fZrrb/vabnalkccVgSQ6hDk2FYNkZBrsnAVbccx1kYSeiwS5qay/Da7Rnc8d/yYqSlP0slJuPoLWeoNgYQaUzhlP9FhzeJEv2p8AZMIW5w5vgNYLKfpXfWfORVLBjLikHOQaVEVioP0Cl/QwZ/cZ8yZD4SPYZAIITkKKAMRxzyRXMg96dwFnvld3VLqeQP7+fOVlIOJoBeueB6FBDV9XuC7vULyYIvPvhUJ118ReQSi6JO6yPoIou1dKAy3Py/aX5zhZyWGmPsWzDYe1qCv5wmbu9unkMKxtHYFEi/MHCQFE6lU2inO40WezzWBhd/kfJ1N0SdpqaQbGIz7RGzzRS0WwPAXEunYHm2IgDGCjGxh0qQGPwBq3rD6j3jdgcvLNovTP8hBNtCDYcaHJEgPXtNAMpCncMx1wiqlWJ8sBazGhzx9iR3fwD6A/xBHPcIAYG5oGpb+AXQLRGqifc75oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"crypto-async-6\"\n        title=\"crypto-async-6\"\n        src=\"/static/5197376a105da5d5787a9b2512683a03/140de/crypto-async-6.png\"\n        srcset=\"/static/5197376a105da5d5787a9b2512683a03/7bc88/crypto-async-6.png 275w,\n/static/5197376a105da5d5787a9b2512683a03/c1dff/crypto-async-6.png 550w,\n/static/5197376a105da5d5787a9b2512683a03/140de/crypto-async-6.png 1100w,\n/static/5197376a105da5d5787a9b2512683a03/09a33/crypto-async-6.png 1650w,\n/static/5197376a105da5d5787a9b2512683a03/a969d/crypto-async-6.png 1720w\"\n        sizes=\"(max-width: 1100px) 100vw, 1100px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This is a little more interesting graph, this is not uniform anymore. We had this like weird little tail that's sitting at the end so it's almost look like we took the time when we did only four requests and sort of stuck that to the end and there's actually reason for this and that's because you know these hashing operation in C++ are done in a background thread but Node doesn't spin up a new thread for each request instead Node.js whenever it first starts up it will automatically spin up a preset number of threads which defaults to four. It will spin up these four threads and will constantly reuse those threads for all of its work, and these set of threads is called the thread pool in Node.js and the reason that when we saw four ran together and then the long tail was because we had this default four worker threads in the thread pool so what NodeJS is doing, whenever we make these requests, it can see that first request come through then Node would be like <em>okay I got this I'm gonna assign this to the first thread in the thread pool, the second request will go to the second, the third to the third, fourth to the fourth</em> but when that fifth request comes through Node gonna say <em>alright all of my worker threads are busy right now so I'm gonna take this other request in a queue until one of the worker threads becomes available</em> and then the same thing with the six requests so once that first request finishes. Node can say like <em>\"Alright so now I have one of these threads available again I'm gonna pick off one of these queued requests and assign it to the next two.\"</em> so that's why it really does look like it did four operations and then two because that's actually what it did under the hood and so this is a case where we're actually seeing the limitation in the thread pool</p>\n<h3>Example #2</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">NUM_REQUESTS</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token constant\">NUM_REQUESTS</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    https<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://varunzxzx.github.io/static/.../.../me.webp'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>let's move on to our next example and that is the HTTP module, we have this sample code. This is using the HTTP module what this is gonna do is it's going to download my profile profile photo from my personal website I chose this because there is no CDN sitting in front of this, CDNs ends are great for performance because you know it can do lots of like caching, you can be downloading files closer to where you are geographically and you also decrease your bandwidth but they're not great for this test because CDNs make the timing unpredictable which is not good for benchmarks so we wanted to download something that was very very predictable so I chose this file so what we're doing here is we're downloading it we're listening to the data event to make sure that we're actually going to download all of the data and then we wait for the end event and we're timing from when we call HTTP request to the time the end event is fired so once again we are starting with four requests.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1100px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e95ad7b388f3cff7764a3c8940c8459/a969d/http-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.545454545454554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABv0lEQVQoz32TSU8CQRCFJ0aDCyA6MwKKC+DCMqMgmxpj4noBBvTiykEToxi3aDRRLi6J+APEiz/22V3dIBr18PK+1Eyqq+vNKJ1uEy3OIBRHgLyZFXsADq8JTzBN6nJHqVZ/1uoah90zyeqmcCZF82dQ2LlGfusKFvM6FyRnNy9JOem8Zm1fobh7g8XcITtwCp19JroH4rAzVtSRNFaLZSxbR+Sr62Us1VnW19ZPSPV3VorH5HNrJTj7eUNDNGSsuAYTMDIWQskcosyNTKGJv+pRyYbkSNpCwFyh63I1GvYFZ1E6fsLe0SN5qfwsuPxE+o2575++0JQdWoR212jo6I9B96fh8iWgsevrI5ynibV/OQF1OCmv3DShZ2weF/c1oUoNl5V3Yu5/8fndG24ePrBRuoVNDVHC3yZUh1PspDh6h5Ly1JjgoS/ulaw2OC79Ryju4BwOzqpsJ1VywS/f+fyV9LPuCy2wQAwZSkx8NjxlkWC2KdkspW3MsMQTWZZoHuFUHhOMeY2+BMZ8906vmNDli4PfVuEJ2dQw2nom0K6FSW094+jQI5Qg/xt0fwre0RnaF9V1Uecr4KKGA6LhJ92scJWIuFYzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"http-4\"\n        title=\"http-4\"\n        src=\"/static/1e95ad7b388f3cff7764a3c8940c8459/140de/http-4.png\"\n        srcset=\"/static/1e95ad7b388f3cff7764a3c8940c8459/7bc88/http-4.png 275w,\n/static/1e95ad7b388f3cff7764a3c8940c8459/c1dff/http-4.png 550w,\n/static/1e95ad7b388f3cff7764a3c8940c8459/140de/http-4.png 1100w,\n/static/1e95ad7b388f3cff7764a3c8940c8459/09a33/http-4.png 1650w,\n/static/1e95ad7b388f3cff7764a3c8940c8459/a969d/http-4.png 1720w\"\n        sizes=\"(max-width: 1100px) 100vw, 1100px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>It actually took almost the exact amount same amount of time to download that file four times which we want to see. It took about 250 milliseconds. Now we're gonna do the same thing which we did before and increase the number of requests to six.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1100px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a74a5a029cd696ca2f08a78fc2335593/a969d/http-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.63636363636364%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABtklEQVQoz3VSWU8iYRDkwbiKu4KouN7GRDwQZfGAGXQYbgbxQvFacdc73vH/P5RdLZmg6EOl6+uvU92Vbs+vwUX8/L2g+IoPTZkYn7MwEU6hZzTm/jejayDico9ZqKN88ILS/pPEZ5T2HhXkjuTyu/coyrvAWH1wa53aM7LbtwiMLcEbnNcBfMN/4Fk0qzDydSRyp0gWzpDI/lWQG5JLZCVf/AdTauLNecGKfSRTNwmOiGDMqsEqX2LdOUdqQ2LpXEFuORdYK/1v4azlm4N8EOSE7JLZuoFduUK2Ee2Nd57evP6aV64VbBD4PGE0WYVJG9JtTawZubqCnHlaa+FSa+bPsGwf6qI+CC5ZB64lTkc7BLlVvviWE/HMSasgu6Q3363SekpsEZmGNTb7zG2JuZ07rIqgbyiqZ+MKRowd3R4/dXPpYwU5JyDnVlmjeV6BvMPxbQxOJeGXRbiCXIqRP9W74o05tSe9N6IsvLj34N4hI+HsP6Jy9IrZlQp+9M40thxBtwj6xb6ns38Obf4Q2gPT6OgT3hNSeINhzfEvOLkqBxxT7u1nfkbEZnUi33AU3oGG4EgMb87NdiZbhotuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"http-6\"\n        title=\"http-6\"\n        src=\"/static/a74a5a029cd696ca2f08a78fc2335593/140de/http-6.png\"\n        srcset=\"/static/a74a5a029cd696ca2f08a78fc2335593/7bc88/http-6.png 275w,\n/static/a74a5a029cd696ca2f08a78fc2335593/c1dff/http-6.png 550w,\n/static/a74a5a029cd696ca2f08a78fc2335593/140de/http-6.png 1100w,\n/static/a74a5a029cd696ca2f08a78fc2335593/09a33/http-6.png 1650w,\n/static/a74a5a029cd696ca2f08a78fc2335593/a969d/http-6.png 1720w\"\n        sizes=\"(max-width: 1100px) 100vw, 1100px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>They also took about the exact same amount of time. It also took 250 milliseconds and it did not increase the amount of time it takes to download this file which is different than the results we saw in <code class=\"language-text\">crypto</code>. The reasons for this is, it has nothing to do with node, this is all just about like computer architecture and bottlenecks. Whenever we're downloading a file and especially in this case where we're downloading a file and only saving it to memory, we're not writing it to the hard drive, the limitation is the network itself like whenever we're downloading a file like this our computer is basically sitting there doing nothing most of the time and everyone time you get a little bit of data from the network which it'll take and go process so since we know we're not limited by the number of CPU cores because our CPUs sitting there doing nothing then we don't hit that bottle neck.</p>\n<p>It turns out that it is actually not subjected to the limitations of the thread pool, the reasons for that is inside of NodeJS whenever possible it will actually use C++ asynchronous primitives under the hood. So it is actually possible to do asynchronous coding inside of C++ in certain cases. This is provided by the operating system itself so the way this works is, it looks a little different than JavaScript but it's roughly the same thing, the idea is that we tell the OS , we tell the kernel like <em>I want to go ahead and download this resource</em> and then the kernel is actually going to manage downloading that code, it's happening in the kernel not inside of your application and then what we can do is we can actually ping the kernel and ask <em>hey are you done with this request yet?</em> and eventually it's gonna say <em>yes</em> once it's done we can then go and call some other methods that says <em>all right give me the results for this thing that I requested</em>. Now since this is a part of the kernel, we have to use a different mechanism for each different OS because they have different ways of doing this. On linux this method is called <code class=\"language-text\">epoll</code>, on Mac OS is it called <code class=\"language-text\">kqueue</code> and on windows this is called <code class=\"language-text\">GetQueuedCompletionStatusEX</code> and whenever we are making these asynchronous C++ calls because the operating system is doing it all for us we don't have to really do any code in C++, we don't have to assign it to a background thread and so whenever we're using this it's actually happening in the main thread itself and thus we're not limited to the number of threads in the thread pool.</p>"}},{"node":{"frontmatter":{"title":"Writing My First Babel Plugin","date":"2019-06-11","slug":"/blog/writing-babel-plugin","tags":["babel-plugin","react","css"],"show":"true","authorName":"Varun","authorImg":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='400'%20viewBox='0%200%20400%20400'%20preserveAspectRatio='none'%3e%3cpath%20d='M168%202a116%20116%200%2000-25%205c-5%201-8%202-10%204l-6%205-3%204c1%201%201%202-2%204-7%207-7%2018-1%2040a188%20188%200%200010%2029l4%2012c2%205%202%208%200%2014l-3%205c-1-1-10%208-8%209l2%201c2-1%204%201%203%203l-1%201-1-1c1-1%200-1%200%200l-3-1c0-2-3-1-3%200l-1%204c-1%200-2-1-1-2%200-2%200-2-3%200-1%202-3%204-2%205l-1%201h-1l2%201c2%201%202%201%201%202v1l-1%201c-1-1-1-1%200%200h-2c1%201-6%208-7%208l-1%204-1%201c-1-1-2%200-3%201%200%202%200%202-4%202l-4%202-5%203-2%201-3%202-5%203-3%201v2h-1c-1-1-1-1-2%201l-1%202c-1%200-4%207-4%2012l-1%205%201-4c2-2%203-3%205-2l3-1c-1-1%200-2%201-2l1-1h-1l-1-1v-4c2-3%2016-14%2016-13l-1%202-1%202-2%201-1%202-2%202-1%202v1c-2%200-3%205-1%207l2%203%201%202%201-2%202-2%201-3h-1c-2%200-1-2%201-3%201-2%202-2%202-1h2v-5c1-3%201-3%203-2h2l1%201-1%201v7l-1%201v1l-1%202-1%201v2c2%200%202%201%201%201v2c1%201%201%201-1%201-2-1-2-1-1%202v5l-1%201v2c0%201%200%202-2%202v5l-1%202-1%202-2%202%202%202v11c1%200%201%201-1%201-2%201-2%201%201%201l4%201H61v11l-2%2031c-1%2029-2%2030-5%2029-2%200-3%200-3%202v46c-1%201-1%207%201%2010%202%204%201%208-1%208v3l2%201c1-1%202%200%204%201l4%205c4%203%206%207%205%208h-4c-1%202-9%201-9-1l-1-1-1%202h1l1%201%201%202c2%201%203%203%200%203-1-1-1-1-1%201l1%202%205-1a8369%208369%200%2000239%201c3-2%203-2%203-5%200-2%200-3%202-3%202-1%205%202%205%205-1%202%203%202%2011%202%203-1%204-1%204-4%201-4%205-4%207-1%201%203%205%204%207%202s2-2%200-3c-4-2-1-4%209-4l3-1c0-3-8-8-8-6%200%201-2%202-6%202h-6v-4c0-3%202-5%204-3s3%200%201-2v-3l-2-1c-1-1-2%200-2%201l-5%201c-3-1-5-1-6%201-2%203-2-2%200-6l3-6c0-3%202-2%204%200%203%203%203%203%205%200v-3c-2-1-3-7-1-9%201-2%201-2-1-4h-3c0%204-13%207-16%204-2-1%200-3%202-3%205%200%207-3%207-8-1-4-1-4%203-5%205-1%206-1%206%201%200%204%201%205%204%204%201-1%202-2%201-3-2-6-2-7%201-9%202-2%202-2%200-2l-3-1c-1-1-5%201-5%202%200%202-2%201-3-2-2-4-4-2-5%204%200%207-1%208-3%203%200-2-2-4-3-5l-4-3-5-2-3-4c0-3%200-3-1-2l-3%202c-1%200-4%205-3%206h2c3-2%206%200%206%203l1%206-1%204c-2%201-2%200-2-1%200-2-1-2-6-2l-6%201-2%202c-2%201-3%202-3%204%200%204%200%205-4%204-2%200-2-1-1-2%202-2-1-5-4-3l-10%2010-1%202-3-3c-3-3-5-3-5%200%200%201-1%203-3%203l-2%203c1%201-2%204-3%204-2%200-1-4%200-5%202%200%202-1%200-4l-1-6c1-3-3-3-3%200l-2%202c-2%200-2-2-1-3v-2c-1-1-1-7%201-9v-2c-2-1-4%201-4%204-1%202-1%203-5%203l-4%201-3%202c-1%200-2-3-1-4v-8c0-3%200-4-2-6s-2-2%200-3v-4a270%20270%200%20015-91c0-4-5-21-9-28l-14-31c-4-3-11-8-12-7l-1-1-1-2-3-4c-2-3-2-4-1-10%203-13%208-19%2016-21l7-1%206-2c4-1%208-5%208-7l-2-5-2-8-1-3-1-7%201-6c2-2%201-6-1-9-3-3-3-3-2-6%202-5%202-9-1-13l-6-10-4-6%202-4c4-6%202-19-4-22l-20-8h-13m123%20335l-1%205-2%207c-6%2012-5%2016%203%2014%205-1%206-2%206-5l1-9c2-5%202-5%200-9-3-4-5-5-7-3m-24%2026l-7%203c-2%201-3%201-4-1-1-1-1-1-3%201l-4%203c-2%201-3%203-1%203l2%203c1%202%203%202%204%200%200-3%200-3%202-2h2c2-3%203-2%203%200-1%203-1%203%203%203%204%201%206%204%203%207-2%203-1%204%203%201%203-2%203-2%205-1%205%203%207%201%203-2-2-2-2-2-1-3s2-2%202-5c0-4%201-5%202-2%201%202%203%203%205%201l-2-1c-2%200-3-1%200-3%202-3%201-4-9-5h-8m48%200l-6%201c-3%200-5%200-5%202h-5l-5%202c-3%200-5%202-5%203%200%202%203%202%205%200l4-1c3%202%202%203-3%204s-7%204-3%204c3%200%206%203%205%205%200%202%200%202%202%201%202-3%203-2%203%201%200%202%200%202%204%202l5-2v-5c-1%200%200-4%202-6v-3c-1-4-1-5%202-4%203%200%206-2%205-4h-5'%20fill='%2364ffda'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1,"src":"/static/92b6f14c78faeca823577de6069e4edd/ac0f8/me.jpg","srcSet":"/static/92b6f14c78faeca823577de6069e4edd/c49f2/me.jpg 8w,\n/static/92b6f14c78faeca823577de6069e4edd/eb08a/me.jpg 15w,\n/static/92b6f14c78faeca823577de6069e4edd/ac0f8/me.jpg 30w,\n/static/92b6f14c78faeca823577de6069e4edd/3065f/me.jpg 45w,\n/static/92b6f14c78faeca823577de6069e4edd/b49c9/me.jpg 60w,\n/static/92b6f14c78faeca823577de6069e4edd/f92a2/me.jpg 2896w","srcWebp":"/static/92b6f14c78faeca823577de6069e4edd/c6ef4/me.webp","srcSetWebp":"/static/92b6f14c78faeca823577de6069e4edd/48c71/me.webp 8w,\n/static/92b6f14c78faeca823577de6069e4edd/d12fe/me.webp 15w,\n/static/92b6f14c78faeca823577de6069e4edd/c6ef4/me.webp 30w,\n/static/92b6f14c78faeca823577de6069e4edd/915d4/me.webp 45w,\n/static/92b6f14c78faeca823577de6069e4edd/c26a1/me.webp 60w,\n/static/92b6f14c78faeca823577de6069e4edd/6d214/me.webp 2896w","sizes":"(max-width: 30px) 100vw, 30px"}}},"featuredImg":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='225'%20viewBox='0%200%20400%20225'%20preserveAspectRatio='none'%3e%3cpath%20d='M5%203L1%205%200%207c0%202%201%201%205-2l5-4c2%200%201%202-1%203-2%202-2%202-1%203%201%200%201%201-1%203-3%202-1%203%201%200l5-2c2%200%203-1%202-2l1-1%202-1%202-2%202-1-6-1C10%200%208%201%205%203m20-1c1%201%200%202-3%204l-6%204-5%204-7%205-4%203v54l2-1c3-3%204-2%208%201%203%203%203%203%206%201l2-2c0-3%201-4%203-6l4-3%206-4%207-5%205-3%207%204c0%201%202%204%205%206l5%203v6c0%206%200%207%203%208l5%202c3%200%203%201-1%204-8%207-9%208-19%208-8%201-10%201-10%203h-3l-1-1v-3h-4l-6%201c-4%201-4%202-2%209%202%204%201%204-1%202l-3-7c0-4-4-8-5-6-3%203-11%209-12%208l-1%2011v11h3a137%20137%200%200126-1c2%201%202%201%205-1s20-5%2020-2l1%201c2%200%203%203%202%204l-1-1-1-1h-2c0-1-1-2-2-1v1l3%202c2%202%202%202%205%200l3-3-3-1c-2-1-3-2-2-3s2-1%204%201c1%203%202%203%203%202v-2h1l26-21c1-2-1-1-10%206-10%208-12%208-3%200%2010-9%2013-11%2015-11v2l-1%202%203-2a525%20525%200%200170-56c4-2%2010-8%2010-9l-7%204c-4%204-6%205-9%205-6%200-8%202-5%204%202%201%202%201-10%2010-10%208-9%208-15%203-4-2-5-4-4-4l12-9-1-3c-3-4%202-7%2010-5%203%200%204%200%207-2%203-3%2021-6%2022-4l9-6a691%20691%200%200116-13V3l2-2h-9l-10%202c-9%200-9%200-12%204l-6%203c-1-1-1-1%202-3l5-5%201-2h-22l-4%204c-4%204-10%206-15%205-3-1-6-5-6-7s-2-2-48-2a449%20449%200%2000-53%202m181%200l-2%205c-1%202-1%202%201%201h5c1%202%201%202-3%204l-5%203%205%206c4%202%208%202%2010%200%201-2%201-2-2-1h-3l2-2c1-3%202-3%205-2l12%203c2%201%202%205%201%206-3%201-2%203%203%207%205%205%206%206%205%203%200-2%200-2%202-2l2-1%201-1c1%201%200%207-2%207l3%203a1769%201769%200%200145%2033c5%205%209%207%2010%206l-3-2c-1-1-2-1-1-2s4%200%207%202l-1%204c-2%206%203%2017%206%2013%201-1%200-2-1-2-2-2-1-3%203-6l3-3%201%203%203%203h3c2%200%202%201-2%202-5%203-7%206-3%205%203-2%204%200%202%203v3c2%201%203%200%203-2-1-2%200-2%201-1l4-1c2-1%202-1%203%202%201%202%201%202%203%201%202-2%202-2-1-5l-2-3%208%202%201%203-1%203c-2-1-2%200-1%203l2-1c1-2%202-2%204-2%203%201%202%204-3%209-3%203-3%203-6%201-4-2-6-1-6%203%200%203-6%209-8%209l-2%201-6%207a1181%201181%200%2000-40%2036%201362%201362%200%2000-38%2034%20560%20560%200%2001-27%2022c-2%201%202%201%2010%201h12l2-4a698%20698%200%200170-63%20950%20950%200%200154-45c3-3%204-5%204-7v-2l-3%202-6%206c-4%203-6%204-6%201%200-2%205-10%207-11%201-1%200-3-2-4l-6-2c-5-2-6-4-4-5l-8-8c-12-9-12-9-11-12h5v-2l1%202%201%203%201-1h2c2%200%203%200%205-2s2-2%205%201c5%204%209%203%207-2-1-4-14-13-17-14a800%20800%200%2001-66-46c-3-4%202-4%206%200l9%207%205%203%202-2%202-2v5l1%202a1213%201213%200%200125%2019l7%205c2%202%202%202%203%201%201-2%201-2%203-1v3c-1%201%203%204%206%204%204%200%2015%208%2015%2012l2%202%201-1c-1-2-1-3%2038-6l12-2v-7c0-7-1-17-2-14l-1%201c-2%200-1-3%201-4s2-9%202-30V0h-44a611%20611%200%2000-53%202l-5%203-3%202-1-5c0-2-1-2-16-2h-16l1%203c0%204-2%204-6%201l-5-3-6-1c-2%200-3%200-4%203-3%205-2%208%201%209l4-2c1-2%203-3%203-2%203%201%203%203-1%207l-4%204%203-1%206%202c2%203%202%203%202%2010%200%209%201%2011%205%208%203-2%206-1%2013%205%208%206%2010%209%207%2011l-4%201c-2%200-13-7-15-10-2-1-3-1-3%201%201%202%200%201-4-2s-5-8-4-14-1-10-5-10l-4%202-2-1-4-4c-2-1-3-3-2-3%200-1-2-3-6-5l-8-6c-5-4-11-4-14-1m-99%207c-3%204-4%207-1%2012%202%204%205%205%2011%204%2015-2%2016-19%202-19h-2l3%201c3%202%207%207%206%208l-6-4c-7-6-8-6-13-2m245-2l-1%203c1%201-2%205-3%205l-1-2-2-1-2%201v2l1%201%201%202%201%201%206-1%2016-4c0-2-6-4-9-4-2%201-3%201-3-1-1-3-2-4-4-2M97%2023l1%201c2%200%207%205%206%206l-2-1-13-6c-2%200-6%205-7%209-1%2010%2015%2014%2023%205%204-5%201-13-5-15l-3%201m73%2018c-6%204-7%206-10%2013-3%208-3%209-2%2012%201%202%201%202%204%200l5-2%206-4%2013-9c1%200-2%204-7%207-7%206-11%2010-9%2010l14-12c13-11%2015-11%2028-1a147%20147%200%200147%2034l9%208c12%2010%2016%2013%2016%2016l-11%2012c-13%2010-13%2010-10%2012v8l5-2%2010-4c8-2%2018-11%2018-15%200-5-5-16-8-17l-2-2a494%20494%200%2000-95-67c-13-3-14-3-21%203M65%2041c-9%205-6%2018%203%2018%2013%200%2020-10%2013-17-3-3-5-4-5-2l2%201c2%201%205%207%204%208l-7-5c-6-6-6-6-10-3m211%2019c5%205%2014%208%2014%205%200-1%2012-2%2013-1l-1%202c-2%202-2%202%200%204%201%202%202%202%204%201l2-1-2-2c-2-3-2-4%202-2%203%202%203%206%201%206l-1%202-1%201-1%203c0%204%202%203%204-3l2-3%206-4%207-5v-1c0-3-10%201-10%203v2l-3-3-3-3-11-1-14-1h-3l-5-1c-5-3-5-2%200%202M155%2073c-6%206-17%2012-17%209%200-4-4-1-26%2017-32%2026-34%2028-27%2034%204%203%205%204%204%201h2c1%201%202%202%201%203v2l3%202c2%202%203%202%204%200%202-2%202-2%207%203%206%204%206%204%204%206v3c1%202%203%203%203%201-2-3%201-5%203-3%203%203%203%204%200%204-5%200-3%202%203%208l20%2015c13%2011%2015%2012%2015%209%200-2%201-3%203%200v3c-1%201-1%201%202%201%202%200%204%201%208%205l4%205c-5%200%203%207%209%208%205%201%206%201%2015-8a801%20801%200%200128-23l3-1-4-2c-5-3-4-4-21%2013-11%2010-12%2010-24-1-17-15-17-16-12-16l4-1-4-1c-4%201-4%201-16-9a602%20602%200%2001-21-18c0%203%200%203-12-7-13-11-14-13-7-18l7-6%208-6c5-4%206-6%204-7-3-3%207-12%2012-12%202%201%204%200%208-3l5-3c0%202%201%201%205-2l2-3c-2%201-2%201-1-1%200-4-1-4-4-1m41%2016c-6%201-6%201-3%202l9%202c6%201%206%201%204%203a494%20494%200%2001-59%2020c2%202%201%203-1%203l-3%201h5l7-1%203%201h-1c-5-1-3%201%205%204%2011%203%2013%204%2026%205%2017%202%2025-1%2025-8%200-2%200-2%208-2%2024%200%2024-16%200-26-6-3-10-4-16-4h-9m172%201c-5%204-6%205-4%206l1%203c0%203%200%203-1%201l-2-3c-2-2-1%202%201%205l3%206c0%202%201%203%202%202s1-1%2013%207l14%2010%205%204v-14l-7-5-6-4%205-1c8-2%208-2%208-5%200-4-1-5-10-3l-11%201-7%201%201-7c0-7%200-7-5-4m-161%2013l-11%204%207%203c7%202%2024%203%2027%201%201-2-1-5-6-9s-4-4-17%201m-34%2010l-11%204c-2%201%2019%206%2031%206%2014%201%2014-4%200-10l-8-3-12%203m180%209a1202%201202%200%2000-100%2095h-4c-2-1-3%200-6%203-5%204-6%205-3%205l2-1h2c3%202%2013%201%2013-1-3-5%2019-13%2037-13%203%200%204-1%206-4%206-8%2010-8%2018-1l6%204%203%201c3%203%203%203%202%207l-5%206-3%202h14c13%200%2014%200%2015-2v-3l2-1c2%201%202%205%200%205-1%201%203%201%2010%201%2010%200%2011%200%2013-2%203-4%207-4%208%200%201%202%202%202%209%202h9v-4c0-5-1-10-2-9l-2-1c-2-2-3-1-3%201%201%202%200%203-1%205-3%203-6%205-6%203l-3-4c-2-3-3-4-2-5v-1l-3%202c-1%202-3%203-9%204a216%20216%200%2000-24%203v-8c1-3%202-6%201-9l-3%202c-5%203-9%203-14%202-5-2-6-2-8-7l-2-7c0-6%207-12%2012-11h3c0-2%206%200%209%202%204%203%204%203%207-1%205-9%205-9%2025-11l21-2c3-1%203-1%203%203s2%204-19%206c-13%201-11%200-24%2016l-8%2010%2011-1c12-2%2031-4%2031-2l-3%204-3%204%202%203c2%203%204%203%202%200-1-1%200-2%202-4%203-4%206-4%208%200l2%204v-4c0-2-1-3-2-3-2-1-3-6-1-6%203%200%203-4%203-33%200-15%200-26-1-24%200%204%200%204-4%205-5%200-3%201-20-11-14-11-14-11-12-13%201-1%202-3%201-4v-4c0-3%200-3-12%207m-305%202c-2%202-2%203-1%204l1%203c-1%201-4-3-4-4l-2%201c-2%201-2%202-1%202%202-1%204%201%204%203%200%201-1%201-3-1l-3-1c-1%200-1%201%201%202%203%202%201%203-4%203l-20%202-15%201v25l1%2026v2c-2%201-1%205%202%208l4%203%201%202v4l-1-1c0-1-1-1-1%201H4c-2-2-3-1-3%202%201%203%206%206%207%205l3-1h2l-1-1-2-2%202-2c3-2%203-2%202-5s-1-7%202-10l2-2-3-3-3-3%203-2c2-3%205-2%203%200l2%201h2v2c1%200%205%203%208%207%208%206%2010%205%203-2-3-4-3-4-1-4%206%202%2010%207%2010%2013l2%205c1%201%202%202%201%203s0%203%201%205c2%203%203%2010%201%209h-1c-1%201%207%201%2024%201%2025%200%2026%200%2027-2%202-3%201-3-2-2l-9%202c-9%200-14-5-14-12%200-3%200-4-2-4%200%201-3%200-5-2-4-4-4-4-3-21v-15c-2-6-2-7%201-4l14%2013c12%2010%2012%2010%2014%208s2-2-9-11c-16-15-17-15-19-15-4%201-5-3-4-11v-8l-4-3-6-3c-3%201-3-1%202-5%204-3%204-3%202-4l-3-3c-1-1-1-1-2%201m302%2016l-9%207-4%205c2%201%2032-2%2032-3l-16-12-3%203m-328%204l-8%206v2h2l1%201%201%201%201%201c-2%202%201%201%204-2%204-3%204-4%203-6-2-3-1-4%201-2l1%203c-1%202%201%201%202%200v-2c-2-1-1-3%201-2l1-1c0-1%200-2-1-1l-1-1c0-3-1-2-8%203m70%2050c-2%203-2%203%202%204%206%202%2010%2010%208%2014v3c1%200%208-6%208-8l11%208c10%209%2012%2010%2015%2010h5l-4-3a237%20237%200%2000-31-25c-2%200-1%202%202%203l2%203-10-7c-4-4-6-4-8-2m-58%2018l-7%202c-3%200-3%201-1%204%202%204%201%206-1%206s-6-5-6-8c0-2%200-2-2%200-2%203-2%204-1%207%201%202%202%202%2013%202h12l1-3v-6l-1-1-1-2c0-5-1-5-6-1'%20fill='%2364ffda'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1.7857142857142858,"src":"/static/2876ea1893fe2d51012a49e6707de1a8/b3cab/babel.jpg","srcSet":"/static/2876ea1893fe2d51012a49e6707de1a8/af138/babel.jpg 75w,\n/static/2876ea1893fe2d51012a49e6707de1a8/62067/babel.jpg 150w,\n/static/2876ea1893fe2d51012a49e6707de1a8/b3cab/babel.jpg 300w,\n/static/2876ea1893fe2d51012a49e6707de1a8/4507f/babel.jpg 450w,\n/static/2876ea1893fe2d51012a49e6707de1a8/39f27/babel.jpg 600w,\n/static/2876ea1893fe2d51012a49e6707de1a8/a987b/babel.jpg 934w","srcWebp":"/static/2876ea1893fe2d51012a49e6707de1a8/5ba9d/babel.webp","srcSetWebp":"/static/2876ea1893fe2d51012a49e6707de1a8/e0887/babel.webp 75w,\n/static/2876ea1893fe2d51012a49e6707de1a8/4a599/babel.webp 150w,\n/static/2876ea1893fe2d51012a49e6707de1a8/5ba9d/babel.webp 300w,\n/static/2876ea1893fe2d51012a49e6707de1a8/ed1b3/babel.webp 450w,\n/static/2876ea1893fe2d51012a49e6707de1a8/6ef99/babel.webp 600w,\n/static/2876ea1893fe2d51012a49e6707de1a8/ce539/babel.webp 934w","sizes":"(max-width: 300px) 100vw, 300px"}}}},"timeToRead":12,"excerpt":"Before digging into Babel plugin, Let’s understand Babel and How It Works? Babel is a transpiler which converts your ES20XX, JSX and such code to ES2015 for better browser compatibility. As new APIs are introduced frequently and the language standards keeps updating, Browsers doesn’t updates itself…","html":"<p>Before digging into Babel plugin, Let’s understand Babel and How It Works? Babel is a transpiler which converts your ES20XX, JSX and such code to ES2015 for better browser compatibility. As new APIs are introduced frequently and the language standards keeps updating, Browsers doesn’t updates itself at such pace. Here Babel comes to the rescue. It allows developers to use modern language features without worrying about the browser compatibility.</p>\n<p>You have been using Babel , If you ever built a React app. React uses JSX which is not a standard Javascript syntax. It is Babel which converts all your wonderful JSX to something which browsers can understand. Babel is not limited to only JSX or React. It supports all modern APIs like async/await.</p>\n<h2>How It Works?</h2>\n<p>Babel goes through 3 major stages in order to perform this magic:</p>\n<ol>\n<li>Parse</li>\n<li>Transform</li>\n<li>Generate</li>\n</ol>\n<h4>Parse</h4>\n<p>The parse stage, takes code and outputs an Abstract Syntax Tree or AST.</p>\n<blockquote>\n<p>“an <strong>abstract syntax tree (AST)</strong>, or just <strong>syntax tree</strong>, is a tree representation of the abstract syntactic structure of source code” - Wikipedia</p>\n</blockquote>\n<p>For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">square</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">n</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> n <span class=\"token operator\">*</span> n<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The AST representation of the above program looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\"><span class=\"token list punctuation\">-</span> FunctionDeclaration:\n  <span class=\"token list punctuation\">-</span> id:\n    <span class=\"token list punctuation\">-</span> Identifier:\n      <span class=\"token list punctuation\">-</span> name: square\n  <span class=\"token list punctuation\">-</span> params [1]\n    <span class=\"token list punctuation\">-</span> Identifier\n      <span class=\"token list punctuation\">-</span> name: n\n  <span class=\"token list punctuation\">-</span> body:\n    <span class=\"token list punctuation\">-</span> BlockStatement\n      <span class=\"token list punctuation\">-</span> body [1]\n        <span class=\"token list punctuation\">-</span> ReturnStatement\n          <span class=\"token list punctuation\">-</span> argument\n            <span class=\"token list punctuation\">-</span> BinaryExpression\n              <span class=\"token list punctuation\">-</span> operator: *\n              <span class=\"token list punctuation\">-</span> left\n                <span class=\"token list punctuation\">-</span> Identifier\n                  <span class=\"token list punctuation\">-</span> name: n\n              <span class=\"token list punctuation\">-</span> right\n                <span class=\"token list punctuation\">-</span> Identifier\n                  <span class=\"token list punctuation\">-</span> name: n</code></pre></div>\n<p>Or as a JavaScript Object like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"FunctionDeclaration\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"square\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"n\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BlockStatement\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ReturnStatement\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">argument</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BinaryExpression\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">operator</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">left</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"n\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">right</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Identifier\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"n\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Note: Some properties have been removed for simplicity.</p>\n</blockquote>\n<h4>Transform</h4>\n<p>The transform stage takes an AST and traverses through it, adding, updating, and removing nodes as it goes along. This is where Babel plugins operate. We’ll come back to this section later.</p>\n<h4>Generate</h4>\n<p>The code generation stage takes the final AST and turns it back into a string of code.</p>\n<h2>Babel Plugin</h2>\n<p>Now when we know how babel operates, let’s dig deep into babel plugins. Babel plugins allows the developers to transform their code anyhow they want. Babel abstracts the complex operations of parsing and generating the code and exposes a set of magical APIs to transform the code as we want. We’ll use these APIs to build our plugin.</p>\n<p>As you already know now, that Babel plugins operates in the <strong>transform</strong> stage. In this stage, we get an object like representation of the code. So, we just need to manipulate that object to change the code.</p>\n<p>Let’s start writing our babel plugin. So, there is a tiny css-in-js library called <a href=\"https://github.com/siddharthkp/use-css#readme\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">use-css</a> by <a href=\"https://twitter.com/siddharthkp\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">siddharthkp</a>. Here is a small demo of it:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> useCSS <span class=\"token keyword\">from</span> <span class=\"token string\">'use-css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Oopsy</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> className <span class=\"token operator\">=</span> <span class=\"token function\">useCSS</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    font-size: 21px;\n    font-style: italic;\n    color: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>props<span class=\"token punctuation\">.</span>color<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n    &amp;:hover {\n      font-weight: bold;\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">because why not?</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Oopsy</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>green<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We’ll create a babel plugin which extracts all the css and puts it in static file because why not :P\nNow, comes the question how will you handle dynamic values like one in the above example. Well I’ve a magic spell for it as well XD.</p>\n<p>Our plugins begins with a function which receives the current babel instance as an argument.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// plugin contents</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then we return an object with a property visitor</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">visitor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// visitor contents</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, what is a <strong>visitor</strong>? In the transform stage(where our plugin operates), babel traverse through the tree means it will visit each node. <strong>Visitor</strong> is an object with some methods which will be invoked by babel once the particular type of node is found. You can see in the object representation of AST above, every node has certain type. We’ll be using this information to build our visitor.\nIt’ll be more clear by the following example:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> MyVisitor <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">Identifier</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Called!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now, the Identifier method will be called every time babel visits a node of type “Identifier”. These visitor methods receives path of the node as argument. To know about different types of node, you can use <a href=\"https://astexplorer.net/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AST explorer</a>. This is going to be your most used resource while building a babel plugin. To manipulate any object you should know the structure of the object. You can view the AST representation of any code with this tool which is very handy.</p>\n<p>For our plugin we need to get all the “useCSS” call because then we’ll be able to get all the styles, and put it in a static style. Then, we will replace the function call with a class name and remove all imports. So the following code</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> useCSS <span class=\"token keyword\">from</span> <span class=\"token string\">'use-css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Oopsy</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> className <span class=\"token operator\">=</span> <span class=\"token function\">useCSS</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    font-size: 21px;\n    font-style: italic;\n    &amp;:hover {\n      font-weight: bold;\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">because why not?</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Oopsy</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>green<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>will be transformed to</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Oopsy</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> className <span class=\"token operator\">=</span> “4vg68s”\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">because why not?</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Oopsy</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>green<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>and all the styles will be moved to bundle.css. For the dynamic values, we’ll be using css variables(magic spell). For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> useCSS <span class=\"token keyword\">from</span> <span class=\"token string\">'use-css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Oopsy</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> className <span class=\"token operator\">=</span> <span class=\"token function\">useCSS</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    font-size: 21px;\n    font-style: italic;\n    color: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>props<span class=\"token punctuation\">.</span>color<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n    &amp;:hover {\n      font-weight: bold;\n    }\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">because why not?</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Oopsy</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>green<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>will be transformed to:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/* js */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">Oopsy</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> className <span class=\"token operator\">=</span> “4vg68s”\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>“<span class=\"token operator\">--</span>sj55zd”<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>color<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    because why not?\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Oopsy</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>green<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* bundle.css */</span>\n<span class=\"token selector\">.4vg68s</span><span class=\"token punctuation\">{</span>\n<span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span>21px<span class=\"token punctuation\">;</span>\n<span class=\"token property\">font-style</span><span class=\"token punctuation\">:</span>italic<span class=\"token punctuation\">;</span>\n<span class=\"token property\">color</span><span class=\"token punctuation\">:</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--sj55zd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\">.4vg68s:hover</span> <span class=\"token punctuation\">{</span>\n<span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span>bold<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To get all the “useCSS” function call we will simply do this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">visitor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">CallExpression</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">!==</span> <span class=\"token string\">'useCSS'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// do the thing</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>CallExpression</strong> is the node type which we need and the <strong>callee</strong> property of that node gives us the function name. Again, I used AST Explorer to find all the properties of the node.\nNow, we need the template literal(styles) passed to the function. For that we are going to traverse its child nodes and get the styles.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">visitor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">CallExpression</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">!==</span> <span class=\"token string\">'useCSS'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        path<span class=\"token punctuation\">.</span><span class=\"token function\">traverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// nested visitor</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>“traverse” method is used to traverse child nodes of a node. It takes a “visitor” object. Now, In this visitor we only need the template literal. So,</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">visitor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">CallExpression</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>callee<span class=\"token punctuation\">.</span>name <span class=\"token operator\">!==</span> <span class=\"token string\">'useCSS'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        path<span class=\"token punctuation\">.</span><span class=\"token function\">traverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token function\">TemplateLiteral</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// do the thing</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now, template literals have two main properties that we’ll be using, “quasis” and “expressions”. Both these properties are an array. “quasis” contains the string part of the string literal and “expressions” contains the variables used in the string literal. For example the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">I love </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>theThing<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> and </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>anotherThing<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>will be represented as:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">“type”</span><span class=\"token operator\">:</span> “TemplateLiteral”<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">“quasis”</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>“<span class=\"token constant\">I</span> love”<span class=\"token punctuation\">,</span> “and”<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">“expressions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>“theThing”<span class=\"token punctuation\">,</span> “anotherThing”<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Note: The values are not stored as array of strings but array of nodes. But, we can get these values from the nodes.</p>\n</blockquote>\n<p>What if we don’t have any variable in the string literal. Then the “expressions” will be empty and “quasis” will only have one node(whole string).\nLet’s write the code to merge these values to get the style</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">TemplateLiteral</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> templateLiteral <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">;</span> <span class=\"token comment\">//get the node</span>\n  <span class=\"token keyword\">const</span> quasis <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>templateLiteral<span class=\"token punctuation\">.</span>quasis<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//get the quasis</span>\n  <span class=\"token keyword\">let</span> staticStyle <span class=\"token operator\">=</span> “”<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// check whether it includes variables or not</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>quasis<span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   quasis<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// the last quasis is marked as tail in AST</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>el<span class=\"token punctuation\">.</span>tail<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> expr <span class=\"token operator\">=</span> templateLiteral<span class=\"token punctuation\">.</span>expressions<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// check whether the value is an object’s property</span>\n      <span class=\"token comment\">// or a normal variable(babel’s api, more on it later)</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span><span class=\"token function\">isMemberExpression</span><span class=\"token punctuation\">(</span>expr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        value <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>expr<span class=\"token punctuation\">.</span>object<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>expr<span class=\"token punctuation\">.</span>property<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        value <span class=\"token operator\">=</span> expr<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">// We are going to use this ‘value’ variable later on.</span>\n      <span class=\"token comment\">// It stores the name of the variable.</span>\n    <span class=\"token punctuation\">}</span>\n    staticStyle <span class=\"token operator\">+=</span> el<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>cooked<span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    staticStyle <span class=\"token operator\">=</span> quasis<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>cooked<span class=\"token punctuation\">;</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Note: I am not going to describe all the properties of the nodes. <a href=\"http://astexplorer.net\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AST Explorer</a> is the best 😄</p>\n</blockquote>\n<p>The above code gets all the string parts(quasis) and store it to the variable <strong>staticStyle</strong>. I’ve only showed how to get the variables but we are not using it yet. Now, if you notice, I am getting the value from <strong>expressions</strong> when the quasis tail(property of that node) is falsy. Because the tail quasis represents the end of the string(there is no variable after it).</p>\n<p>Now, we need to do two things to handle dynamic values.</p>\n<ol>\n<li>Generate a random css variable(It must be unique)</li>\n<li>Add that variable to the style attribute in the JSX</li>\n</ol>\n<p>We are going to use the same hash library used by use-css to create unique css variables. The second step is little complex. We need to add the css variable and its value to the JSX which needs that dynamic style. But, How to find that JSX?</p>\n<p>The only way to find the required JSX is to find the variable which is defined in usercode. If you look at the demo of the use-css above. The <strong>useCSS</strong> function returns the class name and the user stores it in a variable and uses it in the JSX. We are going to trace this variable to get to the JSX.\nNow, comes another issue. We are in the useCSS function call visitor in our plugin. So, how to reach the JSX which resides somewhere else, within the same visitor. Well it is not possible. So, we’ll store the required information somewhere and make a new visitor for JSX and will use the stored information to manipulate the JSX.</p>\n<p>What is the information we are going to store. We need three values for this</p>\n<ol>\n<li>The variable in the usercode(to find the JSX)</li>\n<li>The css variable which we generated</li>\n<li>The value our css variable holds</li>\n</ol>\n<p>Let’s write the code for it</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> hash <span class=\"token keyword\">from</span> <span class=\"token string\">\"@emotion/hash\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> styles <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">TemplateLiteral</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token keyword\">const</span> identifier <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span>parentPath<span class=\"token punctuation\">.</span>parentPath<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token operator\">...</span>\n    <span class=\"token comment\">// generating unique css variable name</span>\n    cssVarName <span class=\"token operator\">=</span> <span class=\"token function\">hash</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// adding it to the style</span>\n    el<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>cooked <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">var(--</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cssVarName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// add the css variabe name with its value to</span>\n    <span class=\"token comment\">// the styles obj(dynamic styles)</span>\n    styles<span class=\"token punctuation\">[</span>identifier<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>cssVarName<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Babel provides the parent path of the node so I used it to get to the user code variable. Also, I am storing the usercode variable as keys in the <strong>styles</strong> object because it will be used to find the JSX. Now, we can find the required JSX. Let’s jump into the code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> t <span class=\"token operator\">=</span> babel<span class=\"token punctuation\">.</span>types<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">visitor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      …<span class=\"token punctuation\">,</span>\n      <span class=\"token function\">JSXAttribute</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>type <span class=\"token operator\">!==</span> <span class=\"token string\">\"JSXExpressionContainer\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>styles<span class=\"token punctuation\">[</span>path<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>expression<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> identifier <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>expression<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// add style attribute to JSX for dynamic styles</span>\n        path<span class=\"token punctuation\">.</span>parentPath<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>attributes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>\n          t<span class=\"token punctuation\">.</span><span class=\"token function\">JSXAttribute</span><span class=\"token punctuation\">(</span>\n            t<span class=\"token punctuation\">.</span><span class=\"token function\">JSXIdentifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"style\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            t<span class=\"token punctuation\">.</span><span class=\"token function\">JSXExpressionContainer</span><span class=\"token punctuation\">(</span>\n              t<span class=\"token punctuation\">.</span><span class=\"token function\">ObjectExpression</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n                t<span class=\"token punctuation\">.</span><span class=\"token function\">ObjectProperty</span><span class=\"token punctuation\">(</span>\n                  t<span class=\"token punctuation\">.</span><span class=\"token function\">StringLiteral</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">--</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>styles<span class=\"token punctuation\">[</span>identifier<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                  t<span class=\"token punctuation\">.</span><span class=\"token function\">Identifier</span><span class=\"token punctuation\">(</span>styles<span class=\"token punctuation\">[</span>identifier<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s a lot of code. Let’s break it down. So, I am searching for the <strong>JSXAttribute</strong> and the first “if” early exits the function if the attributes value is not a user defined variable. Now, the second “if” checks whether we have something to modify in that node. We do this by simply checking whether we have any entry for that user defined variable in our styles object. Because we don’t need to alter the JSX which is not using any dynamic styles.</p>\n<p>Once we pass these tests, we start altering the node. Now, here we are doing something little different. Earlier, we get some information from the node but now we have to build a node i.e. the JSX style attribute.\nAs I said, Babel provides some magical APIs to make our life a lot easier. We can do this using the builder methods from “babel.types”. We also used one helper function before as well from “babel.types” when we are extracting styles from the string literal. The method name for a builder is simply the name of the node type you want to build except with the first letter lowercased. For example if you wanted to build a MemberExpression(node type) you would use</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> t <span class=\"token operator\">=</span> babel<span class=\"token punctuation\">.</span>types<span class=\"token punctuation\">;</span>\nt<span class=\"token punctuation\">.</span><span class=\"token function\">memberExpression</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The arguments of these builders are decided by the node definition, they can all be found here.\nA node definition looks like the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">defineType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MemberExpression\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">builder</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"property\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"computed\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">visitor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"property\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">aliases</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Expression\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"LVal\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>By looking at the <strong>builder</strong> property, you can see the 3 arguments that will be needed to call the builder method (t.memberExpression).\nThis looks pretty simple for <strong>MemberExpression</strong>. But, here we are building a JSX Attribute. I want you to explore how this attribute is built(Use <a href=\"https://github.com/babel/babel/tree/master/packages/babel-types/src/definitions\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">node definitions</a> and <a href=\"http://astexplorer.net\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AST Explorer</a> for reference)</p>\n<p>We forgot to save our styles to a css file. Let’s do it now.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> writeFile <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">visitor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          staticStyle <span class=\"token operator\">=</span> quasis<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>cooked<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bundle.css\"</span><span class=\"token punctuation\">,</span> staticStyle<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This will generate put all the static styles to <strong>bundle.css</strong>. But, the library also accepts scss like syntax and the styles doesn’t includes any class name yet. So, we have to pre-process it as well. We are going to use the same pre-processor used by use-css and the same hashing library to generate classnames.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">getClassName</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">styles</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token string\">\"c\"</span> <span class=\"token operator\">+</span> <span class=\"token function\">hash</span><span class=\"token punctuation\">(</span>styles<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">babel</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">visitor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n          staticStyle <span class=\"token operator\">=</span> quasis<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>cooked<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">        <span class=\"token comment\">// convert string literal into string</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">const</span> finalStaticStyle <span class=\"token operator\">=</span> staticStyle<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\r?\\n|\\r|\\s</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\"></span><span class=\"gatsby-highlight-code-line\">        className <span class=\"token operator\">=</span> <span class=\"token function\">getClassName</span><span class=\"token punctuation\">(</span>finalStaticStyle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\"></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">const</span> rawCSS <span class=\"token operator\">=</span> <span class=\"token function\">stylis</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span> <span class=\"token operator\">+</span> className<span class=\"token punctuation\">,</span> finalStaticStyle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n        <span class=\"token function\">writeFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bundle.css\"</span><span class=\"token punctuation\">,</span> rawCSS<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now our babel plugins saves all the css to a static file while managing the dynamic styles as well. So, if we have done all this job during the build time. Why to repeat pre-processing, hashing etc. in the runtime. We need to remove all the useCSS calls and replace it with the classname which we’ve generated.\nTo do this I’ll simply use the helper method provided by babel. You can find all the babel helper functions <a href=\"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">path<span class=\"token punctuation\">.</span><span class=\"token function\">replaceWith</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span><span class=\"token function\">StringLiteral</span><span class=\"token punctuation\">(</span>className<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>We are done with 99.9% of the work. We’ve to remove the use-css imports as well. I got tired writing this blog post 😅. So, I handover this task to you ✌️.\nThe complete plugin can be found <a href=\"https://github.com/varunzxzx/babel-plugin-use-css\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n<p>By building babel plugin, you feel like you’ve unlocked some new skills. The community has built various cool things like codemods and stuff. The only thing you need to do is to love ASTs 😉.</p>\n<p>I used <a href=\"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">babel-plugin handbook</a> and <a href=\"https://astexplorer.net\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AST Explorer</a> as a reference while building this plugin. You can’t get better resources than these two. I highly suggest you to read the handbook, it includes all the APIs which you need to build the plugin.</p>\n<p>Kindly ping me <a href=\"https://twitter.com/varunzxzx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@varunzxzx</a> if you build something amazing. I’ll be super happy if my post inspires someone.</p>"}}]},"contact":{"edges":[{"node":{"frontmatter":{"title":"Get In Touch"},"html":"<p>Although I'm not currently looking for freelance opportunities, my inbox is always open. Whether for a potential project or just to say hi, I'll try my best to answer your email!</p>"}}]}},"pageContext":{}},"staticQueryHashes":["3115057458"]}